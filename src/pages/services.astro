---
import MyFooter from '../components/MyFooter.astro';
import { STRAPI_URL } from 'astro:env/server';


const cookie = Astro.cookies.get('site_lang');
const lang = cookie?.value ;//|| 'en';

// 2. Map 'ar' to 'ar-EG' if your Strapi uses specific region codes
const strapiLocale = lang === 'ar' ? 'ar-EG' : 'en';

// 3. Construct the Dynamic Path
// Note: We use &populate=* to ensure images/relations are returned
// const STRAPI_URL2 = "http://localhost:1337"; // Or process.env.STRAPI_URL
const sPath = `${STRAPI_URL}/api/services?locale=${strapiLocale}&populate=*`;



async function getServicesData(){
  const response = await fetch(sPath);
  const data = await response.json() ;
  return data.data[0];
}

const ServicesData = await getServicesData();
---
<!DOCTYPE html>
<html lang="en" class="page-services">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSure - Medical Insurance Services</title>
    <meta name="description" content="Comprehensive medical insurance solutions designed to protect you and your family. Experience peace of mind with MedSure's trusted healthcare coverage.">
    <link rel="stylesheet" href="/fonts/cairo/stylesheet.css">
	<link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/contact.css">
    <link rel="stylesheet" href="/css/services.css">
	<link rel="stylesheet" href="/css/counter.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
	<!--<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232563eb'><path d='M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z'/></svg>">-->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header" id="headermain">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="/images/logo_icon.png" alt="MedSure Logo" class="logo-img">
                    </div>
                    <!--<div class="logo-text">
                        <h1>MedSure</h1>
                        <p>Medical Services</p>
                    </div> -->
                </div>

                <nav class="nav-desktop">
                    <a href="/" data-i18n="nav.home">Home</a> | 
                    <a href="/services" class="active" data-i18n="nav.services">Services</a>  | 
                    <a href="/beneficiaries" data-i18n="nav.beneficiaries">Beneficiaries</a>  | 
                    <a href="/medical-network" data-i18n="nav.medical_network">Medical network</a>  | 
                    <!--<a href="/technology">Technology & Innovation</a>-->
                    <a href="/about" data-i18n="nav.about">About Us</a>  | 
                    <a href="/contact" data-i18n="nav.contact">Contact us</a>
                </nav>

                <div class="header-buttons">
                    <!-- <button class="btn btn-outline">Find a Provider</button> 
					<button class="btn btn-medical">Submit a Claim</button>-->

					<a href="/medical-network" data-i18n="nav.find_provider" class="btn btn-medical">Find a Provider</a>
					
					<!--<a href="/medical-network" class="btn btn-outline">Find a Provider</a>
					<a href="/submit-claim" class="btn btn-medical">Submit a Claim</a>-->
                </div>

                <!-- Language Selector -->
                <div class="lang-selector">
				
				
                    <button class="lang-button" type="button" aria-haspopup="true" aria-expanded="false" onclick="toggleLangMenu(event)">
                        <span class="current-lang-label">EN</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="m6 9 6 6 6-6"/>
                        </svg>
                    </button>
                    <div class="lang-menu hidden" role="menu">
                        <button class="lang-option" role="menuitemradio" aria-checked="true" data-lang="en" onclick="setLanguage('en')">
                            <span class="check">✓</span>
                            <span>English</span>
                        </button>
                        <button class="lang-option" role="menuitemradio" aria-checked="false" data-lang="ar" onclick="setLanguage('ar')">
                            <span class="check">✓</span>
                            <span>العربية</span>
                        </button>
                    </div>
                </div>

                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                    <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="4" x2="20" y1="6" y2="6"/>
                        <line x1="4" x2="20" y1="12" y2="12"/>
                        <line x1="4" x2="20" y1="18" y2="18"/>
                    </svg>
                    <svg class="close-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m18 6-12 12"/>
                        <path d="m6 6 12 12"/>
                    </svg>
                </button>
            </div>

            <div class="mobile-menu hidden">
                <nav class="mobile-nav">
				    <a href="/" data-i18n="nav.home">Home</a>
                    <a href="/services" class="active" data-i18n="nav.services">Services</a>
                    <a href="/beneficiaries" data-i18n="nav.beneficiaries">Beneficiaries</a> 
                    <a href="/medical-network" data-i18n="nav.medical_network">Medical network</a> 
                    <!--<a href="/technology">Technology & Innovation</a>-->
                    <a href="/about" data-i18n="nav.about">About Us</a> 
                    <a href="/contact" data-i18n="nav.contact">Contact us</a>

                    <div class="mobile-buttons">
					<!-- <button class="btn btn-outline">Find a Provider</button> 
					<button class="btn btn-medical">Submit a Claim</button>-->
					
					<a href="/medical-network" data-i18n="nav.find_provider" class="btn btn-medical">Find a Provider</a>
					
					<!-- <a href="/medical-network" class="btn btn-outline">Find a Provider</a>
					<a href="/submit-claim" class="btn btn-medical">Submit a Claim</a> -->
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Hero Section -->
        <section class="services-hero">
            <div class="container">
                <h1>{ServicesData.PageTitle}</h1>
                <p>{ServicesData.PageDescription}</p>
            </div>
        </section>

        <!-- Services Grid -->
        <section class="container" style="padding: 4rem 0;">
            <div class="service-grid">
                <!-- TPA Services -->
                <div class="service-card collapsed">
                    <div class="service-icon">
                        <img src={`${STRAPI_URL}${ServicesData.TPAServices_FeatureImage?.url}`} alt="TPA Services" />
                    </div>
                    <div class="service-content">
                        <h2>{ServicesData.TPAServices.Title}</h2>
                        <div class="service-details">
                            <p set:html={ServicesData.TPAServices.Description}></p>
                        </div>
                        <button class="show-more" type="button">Show more</button>
                    </div>
                    <a href={ServicesData.TPAServices.BtnLink} class="cta-button">{ServicesData.TPAServices.BtnName}</a>
                </div>

                <!-- Self-Funded Programs -->
                <div class="service-card collapsed">
                    <div class="service-icon"> 
                        <img src={`${STRAPI_URL}${ServicesData.SelfFundedPrograms_FeatureImage?.url}`} alt="Self-Funded Programs" />
                    </div>
                    <div class="service-content">
                        <h2>{ServicesData.SelfFundedPrograms.Title}</h2>
                        <div class="service-details">
                            <p set:html={ServicesData.SelfFundedPrograms.Description}></p>
                    
                        </div>
                        <button class="show-more" type="button">Show more</button>
                    </div>
                    <a href={ServicesData.SelfFundedPrograms.BtnLink} class="cta-button">{ServicesData.SelfFundedPrograms.BtnName}</a>
                </div>

                <!-- Cash / Discount Cards -->
                <div class="service-card collapsed">
                    <div class="service-icon">
                        <img src={`${STRAPI_URL}${ServicesData.CashDiscountCards_FeatureImage?.url}`} alt="Cash / Discount Cards" />
                    </div>
                    <div class="service-content">
                        <h2>{ServicesData.CashDiscountCards.Title}</h2>
                        <div class="service-details">
                            <p set:html={ServicesData.CashDiscountCards.Description}></p>
                            
                        </div>
                        <button class="show-more" type="button">Show more</button>
                    </div>
                    <a href={ServicesData.CashDiscountCards.BtnLink} class="cta-button">{ServicesData.CashDiscountCards.BtnName}</a>
                </div>

                <!-- Pre-Insurance & Employment Checkups -->
                <div class="service-card collapsed">
                    <div class="service-icon">
                        <img src={`${STRAPI_URL}${ServicesData.PreInsuranceEmploymentCheckups_FeatureImage?.url}`} alt="Pre-Insurance & Employment Checkups" />
                    </div>
                    <div class="service-content">
                        <h2>{ServicesData.PreInsuranceEmploymentCheckups.Title}</h2>
                        <div class="service-details">
                            <p set:html={ServicesData.PreInsuranceEmploymentCheckups.Description}></p>
                        
                        </div>
                        <button class="show-more" type="button">Show more</button>
                    </div>
                    <a href={ServicesData.PreInsuranceEmploymentCheckups.BtnLink} class="cta-button">{ServicesData.PreInsuranceEmploymentCheckups.BtnName}</a>
                </div>

                <!-- Patient Support Programs -->
                <div class="service-card collapsed">
                    <div class="service-icon">
                        <img src={`${STRAPI_URL}${ServicesData.PatientSupportPrograms_FeatureImage?.url}`} alt="Patient Support Programs" />
                    </div>
                    <div class="service-content">
                        <h2>{ServicesData.PatientSupportPrograms.Title}</h2>
                        <div >
                            <p set:html={ServicesData.PatientSupportPrograms.Description}></p>
                        </div>
                        <!--<button class="show-more" type="button">Show more</button>-->
                    </div>
                    <a href={ServicesData.PatientSupportPrograms.BtnLink} class="cta-button">{ServicesData.PatientSupportPrograms.BtnName}</a>
                </div>

                <!-- Drug Detection Campaigns -->
                <div class="service-card collapsed">
                    <div class="service-icon">
                        <img src={`${STRAPI_URL}${ServicesData.DrugDetectionCampaigns_FeatureImage?.url}`} alt="Drug Detection Campaigns" />
                    </div>
                    <div class="service-content">
                        <h2>{ServicesData.DrugDetectionCampaigns.Title}</h2>
                        <div >
                            <p set:html={ServicesData.DrugDetectionCampaigns.Description}></p>
                            <!--<p>All services include:</p>
                            <ul class="service-features">
                                <li>Smart claim processing</li>
                                <li>24/7 approvals</li>
                                <li>Roving doctors & DOS services</li>
                                <li>Paperless medication dispensing</li>
                                <li>Reimbursement via bank transfer</li>
                            </ul>-->
                        </div>
                        <!--<button class="show-more" type="button">Show more</button> -->
                    </div>
                    <a href={ServicesData.DrugDetectionCampaigns.BtnLink} class="cta-button">{ServicesData.DrugDetectionCampaigns.BtnName}</a>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section style="background: #f8fafc; padding: 5rem 0; text-align: center;">
            <div class="container">
                <h2 style="color: var(--color-trust-blue); margin-bottom: 1.5rem;">{ServicesData.EndTitle}</h2>
                <p style="max-width: 700px; margin: 0 auto 2rem; font-size: 1.1rem; color: var(--color-foreground);">
                   {ServicesData.EndDescription}
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <a href="/contact" class="cta-button">{ServicesData.BtnName1}</a>
                    <a href="/contact" class="cta-button outline">{ServicesData.BtnName2}</a>
                </div>
            </div>
        </section>
    </main>

   <!-- Footer -->
    <MyFooter />

    <!-- In the head section, add this before main.js -->
	<script is:inline src="/js/translations.js"></script>
	<script is:inline src="/js/main.js"></script>
    <script is:inline src="/js/counter.js"></script>
    <script is:inline>
    (function() {
        var cards = document.querySelectorAll('.service-card');
        cards.forEach(function(card){
            var btn = card.querySelector('.show-more');
            if(!btn) return;
            btn.addEventListener('click', function(){
                var expanded = !card.classList.contains('collapsed');
                if (expanded) {
                    card.classList.add('collapsed');
                    btn.textContent = 'Show more';
                } else {
                    card.classList.remove('collapsed');
                    btn.textContent = 'Show less';
                }
            });
        });
    })();
    </script>
</body>
</html>